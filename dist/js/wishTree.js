function drag(e){var t=0,n=0;e.addEventListener("touchstart",function(o){function i(o){o.targetTouches[0].identifier==d&&(t=o.targetTouches[0].pageX-r,n=o.targetTouches[0].pageY-s,e.style.WebkitTransform="translate("+t+"px,"+n+"px)")}function a(e){e.changedTouches[0].identifier==d&&(document.removeEventListener("touchmove",i,!1),document.removeEventListener("touchend",a,!1))}var r=o.targetTouches[0].pageX-t,s=o.targetTouches[0].pageY-n,d=o.targetTouches[0].identifier;document.addEventListener("touchmove",i,!1),document.addEventListener("touchend",a,!1),o.preventDefault()},!1)}DOMReady(function(){function createWish(Username,Content,time,id){var oDate=new Date;oDate.setTime(1e3*time);var t=oDate.getFullYear()+"-"+toDouble(oDate.getMonth())+"-"+toDouble(oDate.getDate())+" "+toDouble(oDate.getHours())+":"+toDouble(oDate.getMinutes())+":"+toDouble(oDate.getSeconds()),oDiv=document.createElement("div");oDiv.className="wishContent",oDiv.style.background="rgb("+rnd(0,256)+","+rnd(0,256)+","+rnd(0,256)+")",oDiv.style.opacity=.7,oDiv.style.filter="alpha(opacity=70)";for(var i=0;i<aImg.length;i++)aImg[i].onclick=function(){oContent.value+="["+this.alt+"]"};for(var arr1=["[抓狂]","[抱抱]","[害羞]","[酷]","[嘻嘻]","[太开心]","[偷笑]","[钱]","[花心]","[挤眼]"],arr2=["zhuakuang","baobao","haixiu","ku","xixi","taikaixin","touxiao","qian","huaxin","jiyan"],i=0;i<arr1.length;i++)Content.indexOf(arr1[i])!=-1&&(Content=Content.replace(arr1[i],' <img src="./img/phiz/'+arr2[i]+'.gif">'),i--);oDiv.innerHTML='<div class="wishH"><span>昵称：'+Username+"</span><b>No:"+id+'</b></div><div class="wishXXX"><div class="wishL'+(id%5+1)+'"></div><div class="wishR">'+Content+'</div></div><div class="wishTime">'+t+'</div><div class="wishClose" id="wishClose"></div>',rndPosition(oDiv);var oWishClose=oDiv.getElementsByTagName("div")[5];return oWishClose.onclick=function(){var sure=confirm("你确定要删除吗？");sure&&ajax({url:URL,data:{act:"delete",id:id},success:function(str){var json=eval("("+str+")");json.error?alert("删除心愿失败！！"):(alert("删除心愿成功！！"),getAll())}})},navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?drag(oDiv):oDiv.onmousedown=function(e){zIndex++,this.style.zIndex=zIndex;var t=e||event,n=t.clientX-oDiv.offsetLeft,o=t.clientY-oDiv.offsetTop;return document.onmousemove=function(e){var t=e||event,i=t.clientX-n,a=t.clientY-o;i<0?i=0:i>document.documentElement.clientWidth-oDiv.offsetWidth&&(i=document.documentElement.clientWidth-oDiv.offsetWidth),a<0?a=0:a>document.documentElement.clientHeight-oDiv.offsetHeight-130&&(a=document.documentElement.clientHeight-oDiv.offsetHeight-130),oDiv.style.left=i+"px",oDiv.style.top=a+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,oDiv.releaseCapture&&oDiv.releaseCapture()},oDiv.setCapture&&oDiv.setCapture(),!1},oDiv}function getAll(){oWishMain.innerHTML="",ajax({url:URL,data:{act:"get"},success:function(str){var json=eval("("+str+")");if(!json.error)for(var arr=json.msg,i=0;i<arr.length;i++){var oDiv=createWish(arr[i].username,arr[i].content,arr[i].time,arr[i].id);oWishMain.appendChild(oDiv)}}})}function rndPosition(e){e.style.left=parseInt(Math.random()*(document.documentElement.clientWidth-252))+"px",e.style.top=Math.round(Math.random()*(document.documentElement.clientHeight-130-252))+"px"}var oWishBtn=document.getElementById("wishBtn"),oLayer=document.getElementById("layer"),oSendForm=document.getElementById("send-form"),oClose=document.getElementById("close"),oSendBtn=document.getElementById("send-btn"),oContent=document.getElementById("content"),oUsername=document.getElementById("username"),oWishMain=document.getElementById("wishMain"),oPhiz=document.getElementById("phiz"),aImg=oPhiz.getElementsByTagName("img"),URL="wish.php",zIndex=9;oWishBtn.onclick=function(){oLayer.style.display="block",oSendForm.style.display="block"},oClose.onclick=function(){oLayer.style.display="none",oSendForm.style.display="none"},oSendBtn.onclick=function(){return""==oUsername.value||""==oContent.value?void alert("请您先输入昵称和心愿吧！"):(oLayer.style.display="none",oSendForm.style.display="none",ajax({url:URL,data:{act:"add",username:oUsername.value,content:oContent.value},success:function(str){var json=eval("("+str+")");json.error?alert("添加心愿失败！"):getAll()}}),oUsername.value="",void(oContent.value=""))},getAll()});